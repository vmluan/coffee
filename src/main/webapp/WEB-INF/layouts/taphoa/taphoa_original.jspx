<html xmlns:jsp="http://java.sun.com/JSP/Page"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:tiles="http://tiles.apache.org/tags-tiles"
	xmlns:spring="http://www.springframework.org/tags">

<jsp:output doctype-root-element="HTML"
	doctype-system="about:legacy-compat"></jsp:output>

<jsp:directive.page contentType="text/html;charset=UTF-8"></jsp:directive.page>
<jsp:directive.page pageEncoding="UTF-8"></jsp:directive.page>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=8" />

<title>QL Tap hoa</title>
<spring:url value="/resources/scripts" var="script" />
<spring:url value="/resources/styles/" var="styles" />

<link rel="shortcut icon"
	href="${pageContext.request.contextPath}/styles/home/images/icon.ico" />

<!-- Bootstrap core CSS -->
<link href="/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

<!-- Custom styles for this template -->
<link href="/resources/taphoa.css" rel="stylesheet" />
<link href="dashboard.css" rel="stylesheet" />



</head>
<body>

	<div id="mainDiv">
		<tiles:insertAttribute name="header" ignore="true" />
		<div class="container">

			<div class="container-fluid">
				<div class="row">




					<div class="test">
						<div class="page-header">

							<div class="col-xs-6 col-sm-3" style="margin-left: 10px;">
								<label> Dang uong: </label> <input type="checkbox" id="danguong"
									onChange="loadTableList()" /> <label> Da Tinh tien: </label> <input
									type="checkbox" id="datinhtien" onChange="loadTableList()" />
							</div>

							<label style="margin-left: 10px;" class="col-xs6 col-sm-2">chon
								ngay xem:</label>
							<div style="margin: 10px;" id='jqxDateTimeInput'></div>


						</div>


						<div id="treemap"></div>


					</div>
				</div>
			</div>



		</div>
		<!-- /container -->


	</div>


	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<!-- Jquery -->
	<script src="/resources/scripts/jquery/jquery-1.10.2.js"
		type="text/javascript">
		<jsp:text/>
	</script>

	<script src="/resources/bootstrap/js/bootstrap.min.js"
		type="text/javascript">
		<jsp:text/>
	</script>
	<script src="/resources/bootstrap/js/docs.min.js"
		type="text/javascript">
		<jsp:text/>
	</script>
	<!--JqueryGrid -->
	<link rel="stylesheet" href="/resources/jqwidgets/styles/jqx.base.css"
		type="text/css" />

	<script type="text/javascript" src="/resources/jqwidgets/jqxcore.js">
		<jsp:text/>
	</script>
	<script type="text/javascript" src="/resources/jqwidgets/jqxdata.js">
		<jsp:text/>
	</script>

	<script type="text/javascript"
		src="/resources/jqwidgets/jqxcalendar.js">
		<jsp:text/>
	</script>
	<script type="text/javascript"
		src="/resources/jqwidgets/jqxdatetimeinput.js">
		<jsp:text/>
	</script>
	<script type="text/javascript" src="/resources/jqwidgets/jqxtreemap.js">
		<jsp:text/>
	</script>
	<script type="text/javascript" src="/resources/scripts/coffee.js">
		<jsp:text/>
	</script>	
	<script type="text/javascript">
		var data = [ {
			label : 'Khu B',
			value : null,
			color : '#B3FAFF',
			data : null
		}, {
			label : 'Khu C',
			value : null,
			color : '#95FF7A',
			data : null
		}, {
			label : 'Khu D',
			value : null,
			color : '#FFA3CE',
			data : null
		}, {
			label : 'Khu E',
			value : null,
			color : '#F1A3FF',
			data : null
		}, {
			label : 'Vòm 1',
			value : null,
			color : '#F1A3FF',
			data : null
		}, {
			label : 'Vòm 2',
			value : null,
			color : '#F1A3FF',
			data : null
		},{
			label : 'Sân thượng',
			value : null,
			color : '#F1A3FF',
			data : null
		},{
			label : 'Trong nhà',
			value : null,
			color : '#F1A3FF',
			data : null
		},{
			label : 'Mận dù',
			value : null,
			color : '#F1A3FF',
			data : null
		},{
			label : 'Mận giữa',
			value : null,
			color : '#F1A3FF',
			data : null
		},{
			label : 'Xích đu',
			value : null,
			color : '#F1A3FF',
			data : null
		},
		{
			label : 'Ban 1',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b1'
			}
		}, {
			label : 'Ban 2',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b2'
			}
		}, {
			label : 'Ban 3',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b3'
			}
		}, {
			label : 'Ban 4',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b4'
			}
		}, {
			label : 'Ban 5',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b5'
			}
		}, {
			label : 'Ban 6',
			value : 2,
			parent : 'Khu B',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b6'
			}
		}, {
			label : 'Ban 7',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b7'
			}
		}, {
			label : 'Ban 8',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b8'
			}
		}, {
			label : 'Ban 9',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b9'
			}
		}, {
			label : 'Ban 10',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b10'
			}
		}, {
			label : 'Ban 11',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b11'
			}
		}, {
			label : 'Ban 12',
			value : 2,
			parent : 'Khu C',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b12'
			}
		}, {
			label : 'Ban 13',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b13'
			}
		}, {
			label : 'Ban 14',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b14'
			}
			
		}, {
			label : 'Ban 15',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b15'
			}
		}, {
			label : 'Ban 16',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b16'
			}
		}, {
			label : 'Ban 17',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b17'
			}
		}, {
			label : 'Ban 18',
			value : 2,
			parent : 'Khu D',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b18'
			}
		}, {
			label : 'Ban 19',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b19'
			}
		}, {
			label : 'Ban 20',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b20'
			}
		}, {
			label : 'Ban 21',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b21'
			}
		}, {
			label : 'Ban 22',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b22'
			}
		}, {
			label : 'Ban 23',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b23'
			}
		}, {
			label : 'Ban 24',
			value : 2,
			parent : 'Khu E',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b24'
			}
		}, {
			label : 'Ban 25',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b25'
			}
		}, {
			label : 'Ban 26',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b26'
			}
		}, {
			label : 'Ban 27',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b27'
			}
		}, {
			label : 'Ban 28',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b28'
			}
		}
		, {
			label : 'Ban 29',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b29'
			}
		}, {
			label : 'Ban 30',
			value : 2,
			parent : 'Vòm 1',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b30'
			}
		}, {
			label : 'Ban 31',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b31'
			}
		}, {
			label : 'Ban 32',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b32'
			}
		},
		{
			label : 'Ban 33',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b33'
			}
		}, {
			label : 'Ban 34',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b34'
			}
		},				
		{
			label : 'Ban 35',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b35'
			}
		}, {
			label : 'Ban 36',
			value : 2,
			parent : 'Vòm 2',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b36'
			}
		},			
		{
			label : 'Ban 37',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b37'
			}
		}, {
			label : 'Ban 38',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b38'
			}
		}				
		, {
			label : 'Ban 39',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b39'
			}
		}, {
			label : 'Ban 40',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b40'
			}
		},			
		{
			label : 'Ban 41',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b41'
			}
		},				
		{
			label : 'Ban 42',
			value : 2,
			parent : 'Sân thượng',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b42'
			}
		}, 
		{
			label : 'Ban 43',
			value : 2,
			parent : 'Trong nhà',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b43'
			}
		},			
		{
			label : 'Ban 44',
			value : 2,
			parent : 'Trong nhà',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b44'
			}
		},			
		{
			label : 'Ban 45',
			value : 2,
			parent : 'Mận dù',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b45'
			}
		},				
		{
			label : 'Ban 46',
			value : 2,
			parent : 'Mận dù',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b46'
			}
		}, 
		{
			label : 'Ban 47',
			value : 2,
			parent : 'Mận giữa',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'b47'
			}
			
		},			
		{
			label : 'Ban 48',
			value : 2,
			parent : 'Mận giữa',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'mangiua_b48'
			}
		},			
		{
			label : 'Ban 49',
			value : 2,
			parent : 'Xích đu',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'xichdu_b49'
			}
		},			
		{
			label : 'Ban 50',
			value : 2,
			parent : 'Xích đu',
			data : {
				customerName : null,
				totalMoney : null,
				tableid : 'xichdu_b50'
			}
			
		}				
		];

		updateTreeMap();
		$("#jqxDateTimeInput").jqxDateTimeInput({
			width : '200px',
			height : '25px',
			theme : 'energyblue'
		});
		$('#jqxDateTimeInput').on('change', function(event) {

			var date = event.args.date;
			var date2 = $("#jqxDateTimeInput").val();
			loadTableList(date2);
		});

		$('#treemap').jqxTreeMap(
				{
					width : 1200,
					height : 700,
					source : data,
					colorRange : 50,
					renderCallbacks : {
						'*' : function(element, value) {

							if (value.data) {
								//	console.log(value);
								element.css('cursor', 'pointer');
								<c:forEach var="table" items ="${table}">
								//console.log("${table.tableNumber}" + value.label);
								if ("${table.status}" == 'DRINKING') {
									if ("${table.tableNumber}" == value.data.tableid) {
										element.css({
											border : '3px solid red'
										});									
									}
								} else if ("${table.status}" == 'PAID') {
									if ("${table.tableNumber}" == value.data.tableid) {
										element.css({
											border : '3px solid green'
										});									
									}
								}
								</c:forEach>

								/*         element.jqxTooltip({
								             content: '<div><div style="font-weight: bold; max-width: 200px; font-family: verdana; font-size: 13px;">' + value.data.title + '</div><div style="width: 200px; font-family: verdana; font-size: 12px;">' + value.data.description + '</div></div>',
								             position: 'mouse',
								             autoHideDelay: 6000,
								             theme: theme
								         });
								 */
								element.click(function() {

									window.location = 'quanlyban/'
											+ value.data.tableid + '?tableacr';
								});	
								 
							} else if (value.data === undefined || value.data === null) {
								element.css({
									backgroundColor : '#fff',
									border : '1px solid #555'
								});
							}
						}
					}

				});

		function loadTableList(tradeDate) {
			if (!tradeDate) {
				tradeDate = $("#jqxDateTimeInput").val();
			}
			var danguong = document.getElementById('danguong').checked;
			var datinhtien = document.getElementById('datinhtien').checked;

			var url = '/';
			var inputData = {
				tradeDate : tradeDate,
				danguong : danguong,
				datinhtien : datinhtien
			};
			$.ajax({
				url : url,
				data : inputData,
				dataType : "html",
				type : 'GET',
				//   data: data,
				success : function(data) {
					//On ajax success do this
					var a = 1;

					$('#treemap').html($(data).find('#treemap').html());

				},
				error : function(xhr, ajaxOptions, thrownError) {
					//On error do this
					alert(xhr.status);
					alert(thrownError);

				}
			});

		};

		function updateTreeMap() {
			console.log('start');
			<c:forEach var="table" items ="${table}">

			for ( var item in data) {
				var tableNumber = "${table.tableNumber}";
				if(data[item].data != null){
					if (data[item].data.tableid == tableNumber) {
						console.log(data[item].label);
						data[item].data.customerName = "${table.customerName}";
						var money = "${table.totalMoney}";
						console.log(money.replace(/\d(?=(\d{3})+\.)/g, '$.'));
						money = formatCurrency(money, '$');
						data[item].data.totalMoney = money;

					}
				}
			}

			</c:forEach>

		};
	</script>

</body>

</html>